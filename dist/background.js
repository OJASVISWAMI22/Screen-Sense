chrome.alarms.create("screenTimeTracker",{periodInMinutes:1});chrome.alarms.create("eyestrainTracker",{periodInMinutes:1/60});chrome.alarms.onAlarm.addListener(t=>{t.name==="screenTimeTracker"?c():t.name==="eyestrainTracker"&&l()});function c(){chrome.storage.local.get(["screenTime","lastResetDate"],t=>{let a=t.screenTime||0,e=t.lastResetDate?new Date(t.lastResetDate):new Date;const r=new Date;(r.getDate()!==e.getDate()||r.getMonth()!==e.getMonth()||r.getFullYear()!==e.getFullYear())&&(a=0,e=r,console.log("New day detected. Resetting screen time.")),a++,chrome.storage.local.set({screenTime:a,lastResetDate:e.toISOString()},()=>{console.log(`Screen time updated: ${a} minutes`)})})}function l(){chrome.storage.local.get(["nextBreak","isOnBreak"],t=>{let a=t.nextBreak??1200,e=t.isOnBreak??!1;a<=0?e?(console.log("Break time ended"),e=!1,a=20*60,chrome.storage.local.set({shouldPlayAlarm:!0})):(console.log("Break time started"),n(),e=!0,a=20,chrome.storage.local.set({shouldPlayAlarm:!0})):a--,chrome.storage.local.set({nextBreak:a,isOnBreak:e},()=>{console.log(`Timer updated: ${a} seconds, isOnBreak: ${e}`)})})}function n(){chrome.notifications.create({type:"basic",iconUrl:"icon.png",title:"Eye Break",message:"Look at something 20 feet away for 20 seconds"},t=>{console.log("Notification shown with ID:",t)})}let o;function s(){o&&clearInterval(o),o=setInterval(()=>{chrome.storage.local.get(["waterIntake","hydrationGoal"],t=>{const a=t.waterIntake||0,e=t.hydrationGoal||2e3;a<e&&m()})},6e4)}function m(){chrome.notifications.create({type:"basic",iconUrl:"icon.png",title:"Hydration Reminder",message:"Time to drink some water!"})}chrome.runtime.onInstalled.addListener(s);chrome.runtime.onStartup.addListener(s);chrome.runtime.onMessage.addListener((t,a,e)=>{t.action==="restartHydrationReminders"&&(s(),e({success:!0}))});chrome.runtime.onMessage.addListener((t,a,e)=>{switch(console.log("Message received:",t),t.action){case"getScreenTime":chrome.storage.local.get("screenTime",r=>{e({screenTime:r.screenTime||0})});break;case"resetScreenTime":chrome.storage.local.set({screenTime:0,lastResetDate:new Date().toISOString()},()=>{console.log("Screen time reset"),e({success:!0})});break;case"takeBreakNow":chrome.storage.local.set({nextBreak:20,isOnBreak:!0,shouldPlayAlarm:!0},()=>{n(),e({success:!0})});break;case"startEyestrainTimer":e({success:!0});break;case"showEyeBreakNotification":n(),e({success:!0});break;case"playAlarm":chrome.storage.local.set({shouldPlayAlarm:!0},()=>{console.log("Alarm flag set to true"),e({success:!0})});break;default:console.log("Unknown action:",t.action),e({error:"Unknown action"})}return!0});chrome.runtime.onStartup.addListener(()=>{chrome.alarms.create("screenTimeTracker",{periodInMinutes:1}),chrome.alarms.create("eyestrainTracker",{periodInMinutes:1/60}),i()});function i(){chrome.storage.local.get(["screenTime","lastResetDate","nextBreak","isOnBreak","dailyGoal"],t=>{const a=new Date,e={};(!t.screenTime||!t.lastResetDate||new Date(t.lastResetDate).getDate()!==a.getDate())&&(e.screenTime=0,e.lastResetDate=a.toISOString()),t.nextBreak===void 0&&(e.nextBreak=20*60,e.isOnBreak=!1,e.shouldPlayAlarm=!1),t.dailyGoal===void 0&&(e.dailyGoal=480),Object.keys(e).length>0&&chrome.storage.local.set(e,()=>{console.log("Storage initialized:",e)})})}chrome.runtime.onInstalled.addListener(i);console.log("Background script loaded");
